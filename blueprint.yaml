models:
  Warehouse:
    id: uuid
    name: string index
    type: string index # enum:main,association,distribution_point
    location: string
    capacity: integer nullable
    is_active: boolean default:true index
    softDeletes: true
    relationships:
      hasMany: Batch, ProductStock, InventoryTransaction:from_warehouse, InventoryTransaction:to_warehouse, User:warehouse, DistributionRecord

  RawMaterial:
    id: uuid
    name: string index
    unit: string # enum:kg,liter,gram,piece,box,bag
    description: text nullable
    is_active: boolean default:true index
    softDeletes: true
    relationships:
      hasMany: Batch
      belongsToMany: Product:&ProductIngredient

  Batch:
    id: uuid
    raw_material_id: uuid foreign
    warehouse_id: uuid foreign
    lot_number: string index
    quantity: decimal:10,2
    expiry_date: date index
    received_date: date
    status: string default:active index # enum:active,expired,quarantined
    notes: text nullable
    relationships:
      belongsTo: RawMaterial, Warehouse
      hasMany: InventoryTransaction

  Product:
    id: uuid
    name: string index
    unit: string # enum:portion,tray,box,package,meal_pack
    description: text nullable
    preparation_time: integer nullable comment:'in_minutes'
    is_active: boolean default:true index
    softDeletes: true
    relationships:
      belongsToMany: RawMaterial:&ProductIngredient
      hasMany: ProductStock, InventoryTransaction, DistributionRecord

  ProductIngredient:
    product_id: uuid foreign
    raw_material_id: uuid foreign
    quantity_required: decimal:10,2
    unit: string # enum:kg,liter,gram,piece
    relationships:
      belongsTo: Product, RawMaterial

  ProductStock:
    id: uuid
    product_id: uuid foreign
    warehouse_id: uuid foreign
    batch_id: uuid foreign nullable comment:'For meal batches with expiry'
    quantity: decimal:10,2
    last_updated: timestamp
    relationships:
      belongsTo: Product, Warehouse, Batch

  InventoryTransaction:
    id: uuid
    type: string index # enum:transfer,return,waste,distribution,adjustment
    from_warehouse_id: uuid foreign nullable
    to_warehouse_id: uuid foreign nullable
    product_id: uuid foreign
    batch_id: uuid foreign nullable
    quantity: decimal:10,2
    status: string default:draft index # enum:draft,pending_approval,approved,rejected,completed
    initiated_by: uuid foreign:users
    notes: text nullable
    transaction_date: timestamp useCurrent index
    relationships:
      belongsTo: Warehouse:from_warehouse, Warehouse:to_warehouse, Product, Batch, User:initiated_by
      hasMany: TransactionApproval, DistributionRecord

  TransactionApproval:
    id: uuid
    transaction_id: uuid foreign
    approver_role: string comment:'receiver,warehouse_manager,compliance_officer'
    approver_id: uuid foreign:users
    step: integer default:1
    status: string default:pending index # enum:pending,approved,rejected
    comments: text nullable
    approved_at: timestamp nullable
    relationships:
      belongsTo: InventoryTransaction, User:approver

  DistributionRecord:
    id: uuid
    transaction_id: uuid foreign
    distribution_area_id: uuid foreign
    beneficiaries_served: integer
    photos: json nullable comment:'Array of photo URLs'
    verified_by: uuid foreign:users nullable
    verified_at: timestamp nullable index
    notes: text nullable
    relationships:
      belongsTo: InventoryTransaction, DistributionArea, User:verified_by

  DistributionArea:
    id: uuid
    name: string index
    location: string
    contact_person: string nullable
    contact_phone: string nullable
    is_active: boolean default:true index
    relationships:
      hasMany: DistributionRecord
